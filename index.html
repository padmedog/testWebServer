<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>threejs test</title>
		<style>
			body {
				margin: 0;
				padding: 0;
			}
			canvas {
				width: 100%;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<script src="three.min.js"></script>
		<script src="StereoEffect.js"></script>
		<script src="DeviceOrientationControls.js"></script>
		<script src="OrbitControls.js"></script>
		<div id="webglviewer"></div>
		<script>/*
		
var WIDTH = window.innerWidth;
var HEIGHT = window.innerHeight;
var renderer = new THREE.WebGLRenderer({antialias:true});
var viewEffect;
renderer.setSize(WIDTH, HEIGHT);
renderer.setClearColor(0xDDDDDD, 1);
document.body.appendChild(renderer.domElement);
viewEffect = THREE.StereoEffect(renderer);
var scene, camera, clock;
clock = new THREE.Clock();

var cube, cubeRotation;
var Game = (function () {
    function Game() {
        this.light = new THREE.PointLight(0xFFFFFF);
        this.light.position.set(-10, 15, 50);
        scene.add(this.light);
        var boxGeometry = new THREE.BoxGeometry(10, 10, 10);
        var boxMaterial = new THREE.MeshPhongMaterial({ color: 0x0095DD });
        this.visibleObject = new THREE.Mesh(boxGeometry, boxMaterial);
        scene.add(this.visibleObject);
		
		
		this.controls = new THREE.OrbitControls(camera, renderer.domElement);
		this.controls.target.set(camera.position.x + 0.15, camera.position.y, camera.position.z);
		this.controls.noPan = true;
		this.controls.noZoom = true;
		
		/*this.particles = new THREE.Object3D();
		this.totalParticles = 200;
		this.maxParticleSize = 200;
		this.particleRotationSpeed = 0;
		this.praticleRotationDeg = 0;
		this.lastColorRange = [0, 0.3];
		this.currentColorRange = [0, 0.3];
		
		var particleTexture = THREE.ImageUtils.loadTexture("particle.png"),
			spriteMaterial = new THREE.SpriteMaterial({
				map: particleTexture,
				color: 0xffffff
			});
		
		for(var i = 0; i < this.totalParticles; i++)
		{
			var sprite = new THREE.Sprite(spriteMaterial);
			sprite.scale.set(64, 64, 1.0);
			sprite.position.set(Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.75);
			sprite.position.setLength(this.maxParticleSize * Math.random());
			sprite.material.blending = THREE.AdditiveBlending;
			this.particles.add(sprite);
		}
		
		this.particles.position.y = 70;
		scene.add(this.particles);*//*
		
		window.addEventListener('deviceorientation',function(e){
			if(!e.alpha){
				return;
			}
			this.controls = new THREE.DeviceOrientationControls(camera, true);
			this.controls.connect();
			this.controls.update();
			
		});
		//renderer.domElement.addEventListener('click', fullscreen, false);
		
        var step = function () {
            //update game information and stuff here
			
            setTimeout(step, 16);
        };
        step();
    }
    Game.prototype.draw = function () {
		//update draw-related things here
		/*var elapsedSeconds = clock.getElapsedTime(),
			particleRotationDirection = this.particleRotationDeg <= 180 ? -1 : 1;
		this.particles.rotation.y = elapsedSeconds * this.particleRotationSpeed * particleRotationDirection;
		if(this.lastColorRange[0] != this.currentColorRange[0] && this.lastColorRange[1] != this.currentColorRange[1])
		{
			for(var i = 0; i < this.totalParticles; i++)
			{
				this.particles.children[i].material.color.setHSL(this.currentColorRange[0], this.currentColorRange[1], (Math.random() * (0.5) + 0.2));
			}
			this.lastColorRange = currentColorRange;
		}*//*
    };
    return Game;
}());

function begin()
{
	scene = new THREE.Scene();
	camera = new THREE.PerspectiveCamera(70, WIDTH/HEIGHT);
	camera.position.z = 50;
	scene.add(camera);
	var game;
	function render() {
		if(typeof game != "undefined")
		{
			game.draw();
		}
		requestAnimationFrame(render);
		if(typeof viewEffect != "undefined")
		{
			viewEffect.render(scene, camera);
		}
		else
		{
			renderer.render(scene,camera);
		}
	}
	render();
	game = new Game();
	
}
window.addEventListener("load",begin);


*/
		</script>
		<script>
			var scene, camera, renderer, element, container, effect, controls, clock;
			var particles = new THREE.Object3D(),
				totalParticles = 200,
				maxParticleSize = 200,
				particleRotationSpeed = 0,
				particleRotationDeg = 0,
				lastColorRange = [0, 0.3],
				currentColorRange = [0, 0.3];
			
			function init() {
				scene = new THREE.Scene();
				camera = new THREE.PerspectiveCamera(90, window.innerwidth / window.innerHeight, 0.001, 700);
				camera.position.set(0, 15, 0);
				scene.add(camera);
				
				renderer = new THREE.WebGLRenderer();
				element = renderer.domElement;
				container = document.getElementById("webglviewer");
				container.appendChild(element);
				
				effect = new THREE.StereoEffect(renderer);
				
				controls = new THREE.OrbitControls(camera, element);
				controls.target.set(
					camera.position.x + 0.15,
					camera.position.y,
					camera.position.z
				);
				controls.enablePan = false;
				controls.enableZoom = false;
				
				var setOrientationControls = function(e){
					if(!e.alpha)
					{
						return;
					}
					controls = new THREE.DeviceOrientationControls(camera, true);
					controls.connect();
					controls.update();
					
					element.addEventListener("click",function(){
						if (container.requestFullscreen)
						{
							container.requestFullscreen();
						}
						else if (container.msRequestFullscreen)
						{
							container.msRequestFullscreen();
						}
						else if (container.mozRequestFullScreen)
						{
							container.mozRequestFullScreen();
						}
						else if (container.webkitRequestFullscreen)
						{
							container.webkitRequestFullscreen();
						}
					},false);
					
					window.removeEventListener("deviceorientation",setOrientationControls,true);
				}
				window.addEventListener("deviceorientation",setOrientationControls,true);
				
				var light = new THREE.PointLight(0x999999, 2, 100);
				light.position.set(50, 50, 50);
				scene.add(light);
				
				var lightScene = new THREE.PointLight(0x999999, 2, 100);
				lightScene.position.set(0, 5, 0);
				scene.add(lightScene);
				
				THREE.ImageUtils.crossOrigin = '';
				var floorTexture = THREE.ImageUtils.loadTexture("textures/wood.jpg");
				floorTexture.wrapS = THREE.RepeatWrapping;
				floorTexture.wrapT = THREE.RepeatWrapping;
				floorTexture.repeat = new THREE.Vector2(50,50);
				floorTexture.anisotropy = renderer.getMaxAnisotropy();
				
				var floorMaterial = new THREE.MeshPhongMaterial({
					color: 0xffffff,
					specular: 0xffffff,
					shininess: 20,
					shading: THREE.FlatShading,
					map: floorTexture
				});
				
				var geometry = new THREE.PlaneBufferGeometry(1000,1000);
				
				var floor = new THREE.Mesh(geometry, floorMaterial);
				floor.rotation.x = -Math.PI / 2;
				scene.add(floor);
				
				var particleTexture = THREE.ImageUtils.loadTexture("textures/particle.png"),
					spriteMaterial = new THREE.SpriteMaterial({
						map: particleTexture,
						color: 0xffffff
					});
				
				for(var i = 0; i < totalParticles; i++)
				{
					var sprite = new THREE.Sprite(spriteMaterial);
					
					sprite.scale.set(64,64,1.0);
					sprite.position.set(Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.75);
					sprite.position.setLength(maxParticleSize * Math.random());
					sprite.material.blending = THREE.AdditiveBlending;
					particles.add(sprite);
				}
				particles.position.y = 70;
				scene.add(particles);
				clock = new THREE.Clock();
				animate();
			};
			
			init();
			
			function animate() {
				var elapsedSeconds = clock.getElapsedTime(),
					particleRotationDirection = particleRotationDeg <= 180 ? -1 : 1;
				
				particles.rotation.y = elapsedSeconds * particleRotationSpeed * particleRotationDirection;
				
				if (lastColorRange[0] != currentColorRange[0] && lastColorRange[1] != currentColorRange[1])
				{
				  for (var i = 0; i < totalParticles; i++)
				  {
					particles.children[i].material.color.setHSL(currentColorRange[0], currentColorRange[1], (Math.random() * 0.5 + 0.2));
				  }
				  lastColorRange = currentColorRange;
				}
				
				requestAnimationFrame(animate);
				
				update(clock.getDelta());
				render(clock.getDelta());
			};
			function resize() {
				var width = container.offsetWidth,
					height = container.offsetHeight;
				camera.aspect = width / height;
				camera.updateProjectionMatrix();
				
				renderer.setSize(width, height);
				effect.setSize(width, height);
			};
			function update(dt) {
				resize();
				camera.updateProjectionMatrix();
				controls.update(dt);
			};
			function render(dt){
				effect.render(scene, camera);
			};
		</script>
	</body>
</html>